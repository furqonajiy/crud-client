<h2 mat-dialog-title>{{ data.isNew ? 'Add Client' : 'Edit Client' }}</h2>

<form [formGroup]="form" (ngSubmit)="save()" novalidate>
  <mat-dialog-content>
    <div class="grid">
      <!-- ID (edit only) -->
      <ng-container *ngIf="!data.isNew">
        <div class="label">ID</div>
        <div class="value id">{{ data.id }}</div>
      </ng-container>

      <!-- Full Name -->
      <div class="label">Full Name*</div>
      <div class="value">
        <mat-form-field appearance="fill" [matTooltip]="getError('fullName')" [matTooltipShowDelay]="0"
          matTooltipPosition="above" #ttFullName="matTooltip">
          <input matInput formControlName="fullName" required maxlength="128"
            (input)="onFieldChange('fullName', ttFullName)" (blur)="onFieldChange('fullName', ttFullName)" />
          <mat-error *ngIf="getError('fullName') as err">{{ err }}</mat-error>
        </mat-form-field>
      </div>

      <!-- Display Name -->
      <div class="label">Display Name*</div>
      <div class="value">
        <mat-form-field appearance="fill" [matTooltip]="getError('displayName')" [matTooltipShowDelay]="0"
          matTooltipPosition="above" #ttDisplay="matTooltip">
          <input matInput formControlName="displayName" required maxlength="30"
            (input)="onFieldChange('displayName', ttDisplay)" (blur)="onFieldChange('displayName', ttDisplay)" />
          <mat-error *ngIf="getError('displayName') as err">{{ err }}</mat-error>
        </mat-form-field>
      </div>

      <!-- Email -->
      <div class="label">Email*</div>
      <div class="value">
        <mat-form-field appearance="fill" [matTooltip]="getError('email')" [matTooltipShowDelay]="0"
          matTooltipPosition="above" #ttEmail="matTooltip">
          <input matInput type="email" formControlName="email" required maxlength="254"
            (input)="onFieldChange('email', ttEmail)" (blur)="onFieldChange('email', ttEmail)" />
          <mat-error *ngIf="getError('email') as err">{{ err }}</mat-error>
        </mat-form-field>
      </div>

      <!-- Details -->
      <div class="label">Details</div>
      <div class="value">
        <mat-form-field appearance="fill">
          <textarea matInput rows="3" formControlName="details" maxlength="500"></textarea>
          <mat-hint align="end">{{ form.get('details')?.value?.length || 0 }}/500</mat-hint>
          <mat-error *ngIf="form.get('details')?.hasError('maxlength')">Max 500 characters</mat-error>
        </mat-form-field>
      </div>

      <!-- Active -->
      <div class="label">Active*</div>
      <div class="value checkbox">
        <mat-checkbox formControlName="active" aria-label="Active"></mat-checkbox>
      </div>

      <!-- Location -->
      <div class="label">Location</div>
      <div class="value">
        <mat-form-field appearance="fill">
          <input matInput formControlName="location" placeholder="City, Region" maxlength="120" />
          <mat-error *ngIf="form.get('location')?.hasError('maxlength')">Max 120 characters</mat-error>
        </mat-form-field>
      </div>

      <!-- Country -->
      <div class="label">Country*</div>
      <div class="value">
        <mat-form-field appearance="fill" class="country-field">
          <mat-label>Country</mat-label>
          <mat-select formControlName="country" panelClass="country-panel" required>
            <mat-select-trigger>
              <span class="fi" [ngClass]="'fi-' + iso(form.get('country')?.value || '')"></span>
              {{ form.get("country")?.value || "Selectâ€¦" }}
            </mat-select-trigger>

            <mat-option *ngFor="let c of countries" [value]="c.name">
              <span class="fi" [ngClass]="'fi-' + c.code"></span>
              {{ c.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('country')?.hasError('required')">Country is required</mat-error>
        </mat-form-field>
      </div>
    </div>
  </mat-dialog-content>

  <!-- actions -->
  <mat-dialog-actions align="end">
    <button mat-button type="button" (click)="cancel()">Cancel</button>
    <button mat-flat-button class="btn-save" type="submit" [disabled]="form.invalid || submitting">Save</button>
  </mat-dialog-actions>
</form>